{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdulfataiojetimi/hellosolar/openai.ts"],"sourcesContent":["import OpenAI from 'openai'\n\nexport const openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY!\n})"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,MAAM,SAAS,IAAI,mLAAM,CAAC;IAC/B,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdulfataiojetimi/hellosolar/src/lib/documents.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\ninterface Document {\n  id: string;\n  title: string;\n  category: string;\n  content: string;\n  filepath: string;\n}\n\ninterface SearchResult {\n  document: Document;\n  score: number;\n}\n\n// Get the project root directory\nconst getProjectRoot = () => {\n  return path.join(process.cwd());\n};\n\n// Read all markdown files from solar_docs recursively\nexport async function getAllDocuments(): Promise<Document[]> {\n  const documents: Document[] = [];\n  const solarDocsPath = path.join(getProjectRoot(), 'src/solar_docs');\n\n  if (!fs.existsSync(solarDocsPath)) {\n    console.warn('solar_docs directory not found');\n    return documents;\n  }\n\n  function scanDirectory(dir: string, category: string = '') {\n    const files = fs.readdirSync(dir);\n\n    for (const file of files) {\n      const fullPath = path.join(dir, file);\n      const stat = fs.statSync(fullPath);\n\n      if (stat.isDirectory()) {\n        // Recurse into subdirectory with updated category\n        const newCategory = category ? `${category}/${file}` : file;\n        scanDirectory(fullPath, newCategory);\n      } else if (file.endsWith('.md')) {\n        // Read markdown file\n        const content = fs.readFileSync(fullPath, 'utf-8');\n        \n        // Extract title from first line (remove # prefix)\n        const titleMatch = content.match(/^#\\s+(.+)$/m);\n        const title = titleMatch ? titleMatch[1] : file.replace('.md', '');\n\n        const doc: Document = {\n          id: `${category}/${file}`.replace('.md', ''),\n          title,\n          category,\n          content,\n          filepath: fullPath,\n        };\n\n        documents.push(doc);\n      }\n    }\n  }\n\n  scanDirectory(solarDocsPath);\n  return documents;\n}\n\n// Simple keyword-based search for relevant documents\nexport async function searchDocuments(query: string, documents?: Document[]): Promise<SearchResult[]> {\n  const docs = documents || await getAllDocuments();\n  const queryLower = query.toLowerCase();\n  \n  // Split query into keywords\n  const keywords = queryLower.split(/\\s+/).filter(k => k.length > 2);\n\n  const results: SearchResult[] = docs.map(doc => {\n    const contentLower = doc.content.toLowerCase();\n    const titleLower = doc.title.toLowerCase();\n    const categoryLower = doc.category.toLowerCase();\n\n    let score = 0;\n\n    // Title matches are worth more\n    for (const keyword of keywords) {\n      if (titleLower.includes(keyword)) score += 10;\n      if (categoryLower.includes(keyword)) score += 5;\n      \n      // Count occurrences in content\n      const matches = (contentLower.match(new RegExp(keyword, 'g')) || []).length;\n      score += Math.min(matches, 10); // Cap at 10 occurrences per keyword\n    }\n\n    return {\n      document: doc,\n      score,\n    };\n  });\n\n  // Filter out zero scores and sort by relevance\n  return results\n    .filter(r => r.score > 0)\n    .sort((a, b) => b.score - a.score)\n    .slice(0, 5); // Return top 5 results\n}\n\n// Get context from top relevant documents\nexport async function getContextForQuery(query: string, maxLength: number = 8000): Promise<string> {\n  const results = await searchDocuments(query);\n  \n  if (results.length === 0) {\n    return '';\n  }\n\n  // Combine content from top documents\n  let context = '';\n  \n  for (const result of results) {\n    const doc = result.document;\n    // Remove the title line from content for context\n    const cleanContent = doc.content.replace(/^#\\s+.+\\n\\n/, '');\n    \n    context += `=== ${doc.title} (${doc.category}) ===\\n`;\n    context += cleanContent + '\\n\\n';\n    \n    if (context.length > maxLength) {\n      break;\n    }\n  }\n\n  return context;\n}\n\n// Get document by ID\nexport async function getDocumentById(id: string): Promise<Document | null> {\n  const documents = await getAllDocuments();\n  return documents.find(doc => doc.id === id) || null;\n}\n\n// Get all categories\nexport async function getAllCategories(): Promise<string[]> {\n  const documents = await getAllDocuments();\n  const categories = new Set(documents.map(doc => doc.category));\n  return Array.from(categories).sort();\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdulfataiojetimi/hellosolar/src/app/api/ask/route.ts"],"sourcesContent":["import { openai } from '../../../../openai'\nimport { NextResponse } from 'next/server'\nimport { getContextForQuery } from '@/lib/documents'\n\nexport async function POST(req: Request) {\n  try {\n    const { question } = await req.json()\n\n    if (!question) {\n      return NextResponse.json({ error: 'Question is required' }, { status: 400 })\n    }\n\n    // Get relevant context from solar documents\n    const context = await getContextForQuery(question)\n\n    // Build system message with context\n    const systemMessage = context\n      ? `You are a helpful solar energy assistant for Hello Solar. Use the following context from our knowledge base to answer the user's question. If the answer is not in the context, provide a general helpful response based on your knowledge about solar energy.\n\nCONTEXT:\n${context}\n\nPlease provide clear, accurate, and helpful answers about solar energy, including panels, inverters, batteries, installation, troubleshooting, and maintenance.`\n      : `You are a helpful solar energy assistant for Hello Solar. Provide clear, accurate, and helpful answers about solar energy, including panels, inverters, batteries, installation, troubleshooting, and maintenance.`\n\n    const completion = await openai.chat.completions.create({\n      model: 'gpt-3.5-turbo',\n      messages: [\n        { role: 'system', content: systemMessage },\n        { role: 'user', content: question }\n      ],\n      temperature: 0.7,\n      max_tokens: 1000,\n    })\n\n    return NextResponse.json({ \n      answer: completion.choices[0].message.content || 'Sorry, I could not generate a response.' \n    })\n  } catch (error) {\n    console.error('Error in ask API:', error)\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,4CAA4C;QAC5C,MAAM,UAAU,MAAM,IAAA,+IAAkB,EAAC;QAEzC,oCAAoC;QACpC,MAAM,gBAAgB,UAClB,CAAC;;;AAGT,EAAE,QAAQ;;+JAEqJ,CAAC,GACxJ,CAAC,kNAAkN,CAAC;QAExN,MAAM,aAAa,MAAM,kHAAM,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACtD,OAAO;YACP,UAAU;gBACR;oBAAE,MAAM;oBAAU,SAAS;gBAAc;gBACzC;oBAAE,MAAM;oBAAQ,SAAS;gBAAS;aACnC;YACD,aAAa;YACb,YAAY;QACd;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,IAAI;QACnD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}